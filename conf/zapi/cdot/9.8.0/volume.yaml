name:                     Volume
query:                    volume-get-iter
object:                   volume

# increase client timeout for volumes
client_timeout:           1m

counters:
  volume-attributes:
    - volume-autosize-attributes:
      - maximum-size
      - grow-threshold-percent

    - volume-id-attributes:
      - ^^instance-uuid             => instance_uuid
      - ^name                       => volume
      - ^node                       => node
      - ^owning-vserver-name        => svm
      - ^containing-aggregate-name  => aggr
      - ^style-extended             => style
      - ^type                       => type

    - volume-inode-attributes:
      - files-used
      - files-total

    - volume-sis-attributes:
      - compression-space-saved               => sis_compress_saved
      - deduplication-space-saved             => sis_dedup_saved
      - total-space-saved                     => sis_total_saved
      - percentage-compression-space-saved    => sis_compress_saved_percent
      - percentage-deduplication-space-saved  => sis_dedup_saved_percent
      - percentage-total-space-saved          => sis_total_saved_percent
      - ^is-sis-volume                        => is_sis_volume

    - volume-space-attributes:
      - expected-available
      - filesystem-size                       => filesystem_size
      - logical-available
      - logical-used
      - logical-used-by-afs
      - logical-used-by-snapshots
      - logical-used-percent
      - physical-used
      - physical-used-percent
      - size                                => size
      - size-available                      => size_available
      - size-total                          => size_total
      - size-used                           => size_used
      - percentage-size-used                => size_used_percent
      - size-used-by-snapshots              => snapshots_size_used
      - size-available-for-snapshots        => snapshots_size_available
      - snapshot-reserve-available          => snapshot_reserve_available
      - snapshot-reserve-size               => snapshot_reserve_size
      - percentage-snapshot-reserve         => snapshot_reserve_percent
      - percentage-snapshot-reserve-used    => snapshot_reserve_used_percent

    - volume-state-attributes:
      - ^state
      - ^status

    - volume-snapshot-attributes:
      - ^auto-snapshots-enabled             => auto_snapshots_enabled
      - ^snapshot-policy
      - snapshot-count

plugins:
  Volume:
    schedule:
      - data: 900s  # should be multiple of data poll duration
    #batch_size: "50"
  LabelAgent:
    # metric label zapi_value rest_value `default_value`
    value_to_num:
      - new_status state online online `0`
    exclude_equals:
      - style `flexgroup_constituent`
    # To prevent visibility of temporary volumes, uncomment these below lines
#    exclude_regex:
#      # Exclusion for SnapProtect/CommVault Intellisnap, Clone volumes gets a “_CVclone” suffix
#      - volume `.+_CVclone`
#      # Exclusion for SnapCenter, Clone volumes gets a “DDMMYYhhmmss” suffix
#      - volume `.+(0[1-9]|[12][0-9]|3[01])(0[1-9]|1[012])\d\d[0-9]{6}`
#      # Exclusion for SnapCreator, This is from creating a clone manually in SnapCreator, Clone volume gets a “cl_” prefix and a “_YYYYMMDDhhmmss” suffix
#      - volume `cl_.+_(19|20)\d\d(0[1-9]|1[012])( 0[1-9]|[12][0-9]|3[01])[0-9]{6}`
#      # Exclusion for SnapDrive/SnapManager, Clone volumes gets a “sdw_cl_” prefix
#      - volume `sdw_cl_.+`
#      # Exclusion for Metadata volumes that may also clutter menus, CRS volumes in SVM-DR or MetroCluster get a “MDV_CRS_” prefix
#      - volume `MDV_CRS_.+`
#      # Exclusion for Metadata volumes that may also clutter menus, Audit volumes get a “MDV_aud_” prefix
#      - volume `MDV_aud_.+`
    replace:
      - style style `flexgroup_constituent` `flexgroup`
  Aggregator:
    - volume<style=flexgroup>volume node,svm,aggr,style

export_options:
  instance_keys:
    - volume
    - node
    - svm
    - aggr
    - style
  instance_labels:
    - state
    - is_sis_volume
    - snapshot_policy
    - type
    - protectedByStatus
    - protectedBy
    - protectionRole
    - all_sm_healthy

