
name:               Aggregate
query:              api/private/cli/aggr
object:             aggr

counters:
  - ^^aggregate                                                    => aggr
  - ^encrypt_with_aggr_key                                         => is_encrypted
  - ^node
  - ^raidtype                                                      => raid_type
  - ^root                                                          => root_aggr
  - ^state
  - ^storage_type                                                  => type
  - ^uuid
  - availsize                                                      => space_available
  - data_compacted_count                                           => space_data_compacted_count
  - data_compaction_space_saved                                    => space_data_compaction_saved
  - data_compaction_space_saved_percent                            => space_data_compaction_saved_percent
  - diskcount                                                      => raid_disk_count
  - files_total                                                    => inode_files_total
  - files_used                                                     => inode_files_used
  - fs_files_private_used                                          => inode_files_private_used
  - fs_inodefile_private_capacity                                  => inode_inodefile_private_capacity
  - fs_inodefile_public_capacity                                   => inode_inodefile_public_capacity
  - fs_maxfiles_available                                          => inode_maxfiles_available
  - fs_maxfiles_possible                                           => inode_maxfiles_possible
  - fs_maxfiles_used                                               => inode_maxfiles_used
  - fs_percent_inode_used_capacity                                 => inode_used_percent
  - hybrid_cache_size_total                                        => hybrid_cache_size_total
  - maxraidsize                                                    => raid_size
  - physical_used                                                  => space_physical_used
  - physical_used_percent                                          => space_physical_used_percent
  - plexes                                                         => raid_plex_count
  - sis_shared_count                                               => space_sis_shared_count
  - sis_space_saved                                                => space_sis_saved
  - sis_space_saved_percent                                        => space_sis_saved_percent
  - size                                                           => space_total
  - snap_files_total                                               => snapshot_files_total
  - snap_files_used                                                => snapshot_files_used
  - snap_maxfiles_available                                        => snapshot_maxfiles_available
  - snap_maxfiles_used                                             => snapshot_maxfiles_used
  - snap_size_available                                            => snapshot_size_available
  - snap_size_used                                                 => snapshot_size_used
  - usedsize                                                       => space_used
  - volcount                                                       => volume_count

endpoints:
  - query: api/private/cli/aggr/object-store
    counters:
      - ^^aggregate                                                => aggr
      - ^object_store_name                                         => cloud_stores
      - used_space                                                 => space_capacity_tier_used
  - query: api/private/cli/aggr/show-space
    counters:
      - ^^aggregate                                                => aggr
      - percent_snapshot_space                                     => snapshot_reserve_percent
      - performance_tier_inactive_user_data                        => space_performance_tier_inactive_user_data
      - performance_tier_inactive_user_data_percent                => performance_tier_inactive_user_data_percent
      - snap_size_total                                            => snapshot_size_total
      - volume_footprints                                          => space_performance_tier_used
      - volume_footprints_percent                                  => space_performance_tier_used_percent
      - filter:
          - bin_num=0
  - query: api/private/cli/aggr/show-efficiency
    counters:
      - ^^aggregate                                                => aggr
      - total_data_reduction_logical_used_wo_snapshots             => logical_used_wo_snapshots
      - total_data_reduction_logical_used_wo_snapshots_flexclones  => logical_used_wo_snapshots_flexclones
      - total_data_reduction_physical_used_wo_snapshots            => physical_used_wo_snapshots
      - total_data_reduction_physical_used_wo_snapshots_flexclones => physical_used_wo_snapshots_flexclones
      - total_logical_used                                         => total_logical_used
      - total_physical_used                                        => total_physical_used

plugins:
  - Aggregate
  - LabelAgent:
      exclude_equals:
        - root_aggr `true`
      value_to_num:
        - new_status state online online `0`
  - MetricAgent:
      compute_metric:
        - snapshot_maxfiles_possible ADD snap_maxfiles_available snap_maxfiles_used
        - space_used_percent PERCENT usedsize size
        - snapshot_used_percent PERCENT snapshot_size_used snapshot_size_total

export_options:
  instance_keys:
    - aggr
    - node
  instance_labels:
    - cloud_stores
    - is_encrypted
    - state
    - type
