# If you need to collect quotas from a cluster that has no qtrees, remove the filter lines below.
# Refer https://github.com/NetApp/harvest/discussions/3057 for more details.
name:                       Qtree
query:                      api/storage/qtrees
object:                     qtree

client_timeout: 2m

counters:
  - ^^name                => qtree
  - ^^svm.name            => svm
  - ^^volume.name         => volume
  - ^export_policy.name   => export_policy
  - ^security_style       => security_style
  - id                    => id
  - filter: # If you need to collect quotas from a cluster with no qtrees, remove this line and the next one.
      - name=!""


endpoints:
  - query: api/private/cli/qtree
    counters:
      - ^^qtree           => qtree
      - ^^volume          => volume
      - ^^vserver         => svm
      - ^oplock_mode      => oplocks
      - ^status           => status
      - filter: # If you need to collect quotas from a cluster with no qtrees, remove this line and the next one.
          - qtree=!""
plugins:
  - Qtree:
      quotaType:
        - tree
#        - user
#        - group
  - LabelAgent:
      replace:
        - oplocks oplocks `enable` `enabled`

export_options:
  instance_keys:
    - qtree
    - svm
    - volume
  instance_labels:
    - export_policy
    - oplocks
    - security_style
    - status
