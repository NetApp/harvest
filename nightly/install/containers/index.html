
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../package-managers/">
      
      
        <link rel="next" href="../k8/">
      
      
      <link rel="icon" href="../../assets/harvest.svg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.6">
    
    
      
        <title>Docker - Harvest</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Harvest" class="md-header__button md-logo" aria-label="Harvest" data-md-component="logo">
      
  <img src="../../assets/harvest.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Harvest
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docker
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/NetApp/harvest" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    NetApp/harvest
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Harvest" class="md-nav__button md-logo" aria-label="Harvest" data-md-component="logo">
      
  <img src="../../assets/harvest.svg" alt="logo">

    </a>
    Harvest
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/NetApp/harvest" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    NetApp/harvest
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is Harvest?
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../package-managers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Package Managers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Containers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Docker
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Compose
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docker Compose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-harvestyml" class="md-nav__link">
    <span class="md-ellipsis">
      Setup harvest.yml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-a-docker-compose-for-your-pollers" class="md-nav__link">
    <span class="md-ellipsis">
      Generate a Docker compose for your Pollers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-everything" class="md-nav__link">
    <span class="md-ellipsis">
      Start everything
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note-on-docker-logging-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Note on Docker Logging Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prometheus-and-grafana" class="md-nav__link">
    <span class="md-ellipsis">
      Prometheus and Grafana
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prometheus and Grafana">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prometheus" class="md-nav__link">
    <span class="md-ellipsis">
      Prometheus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customize-prometheuss-retention-time" class="md-nav__link">
    <span class="md-ellipsis">
      Customize Prometheus's Retention Time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grafana" class="md-nav__link">
    <span class="md-ellipsis">
      Grafana
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manage-pollers" class="md-nav__link">
    <span class="md-ellipsis">
      Manage pollers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manage pollers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-do-i-add-a-new-poller" class="md-nav__link">
    <span class="md-ellipsis">
      How do I add a new poller?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop-all-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Stop all containers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrade-harvest" class="md-nav__link">
    <span class="md-ellipsis">
      Upgrade Harvest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-harvest-docker-image" class="md-nav__link">
    <span class="md-ellipsis">
      Building Harvest Docker Image
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../podman/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Podman
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quadlet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quadlet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../containerd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containerd
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../native/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Native
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system-requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Requirements
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prepare Monitored Systems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Prepare Monitored Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prepare-cdot-clusters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ONTAP cDOT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../asar2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASA r2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prepare-fsx-clusters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Amazon FSx for ONTAP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prepare-7mode-clusters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ONTAP 7mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prepare-storagegrid-clusters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StorageGRID
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prepare-eseries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    E-Series
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prepare-cisco-switch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cisco Switches
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-harvest-basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure Harvest (basic)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Configure Exporters
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Configure Exporters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheus-exporter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prometheus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../influxdb-exporter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    InfluxDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../victoriametrics-exporter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VictoriaMetrics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-grafana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure Grafana
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Configure Collectors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Configure Collectors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-zapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-rest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-keyperf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KeyPerf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-statperf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StatPerf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-ems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EMS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-storagegrid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StorageGRID
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-eseries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    E-Series
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-unix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-cisco-rest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CiscoRest
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dashboards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dashboards
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manage-harvest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manage Harvest Pollers
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure-harvest-advanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure Harvest (advanced)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitor-harvest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitor Harvest
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model Context Protocol (MCP) Server
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Model Context Protocol (MCP) Server
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage Examples
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Help
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            Help
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help/faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help/log-collection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Log Collection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help/config-collection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Config Collection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/ems-alert-runbook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EMS Alert Runbook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matrix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ontap-metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ONTAP Metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storagegrid-metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StorageGrid Metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cisco-switch-metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cisco Switch Metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../eseries-metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    E-Series Metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/power-algorithm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Algorithm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plugins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/rest-perf-metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST Perf Metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/rest-strategy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST Strategy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/templates-and-metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates And Metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../create-storagegrid-dashboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create StorageGRID Dashboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/zapi-and-rest-gap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZAPI and REST gaps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19" >
        
          
          <label class="md-nav__link" for="__nav_19" id="__nav_19_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    About
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release Notes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Compose
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docker Compose">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-harvestyml" class="md-nav__link">
    <span class="md-ellipsis">
      Setup harvest.yml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-a-docker-compose-for-your-pollers" class="md-nav__link">
    <span class="md-ellipsis">
      Generate a Docker compose for your Pollers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-everything" class="md-nav__link">
    <span class="md-ellipsis">
      Start everything
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note-on-docker-logging-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Note on Docker Logging Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prometheus-and-grafana" class="md-nav__link">
    <span class="md-ellipsis">
      Prometheus and Grafana
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prometheus and Grafana">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prometheus" class="md-nav__link">
    <span class="md-ellipsis">
      Prometheus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customize-prometheuss-retention-time" class="md-nav__link">
    <span class="md-ellipsis">
      Customize Prometheus's Retention Time
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grafana" class="md-nav__link">
    <span class="md-ellipsis">
      Grafana
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manage-pollers" class="md-nav__link">
    <span class="md-ellipsis">
      Manage pollers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manage pollers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-do-i-add-a-new-poller" class="md-nav__link">
    <span class="md-ellipsis">
      How do I add a new poller?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop-all-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Stop all containers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrade-harvest" class="md-nav__link">
    <span class="md-ellipsis">
      Upgrade Harvest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-harvest-docker-image" class="md-nav__link">
    <span class="md-ellipsis">
      Building Harvest Docker Image
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Docker</h1>

<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Harvest is container-ready and supports several deployment options:</p>
<ul>
<li>
<p><a href="#docker-compose">Stand-up Prometheus, Grafana, and Harvest via Docker Compose</a>. Choose this if
  you want to hit the ground running. Install, volume and network mounts automatically handled.</p>
</li>
<li>
<p><a href="../harvest-containers/">Stand-up Harvest via Docker Compose</a> that offers
  more flexibility in configuration. Choose this if you only want to run Harvest containers. Since you pick-and-choose what gets built and how it's deployed, stronger familiarity with containers is
  recommended.</p>
</li>
<li>
<p>If you prefer Ansible, David Blackwell created
  an <a href="https://github.com/NetApp/harvest_install">Ansible script</a> that
  stands up Harvest, Grafana, and Prometheus.</p>
</li>
<li>
<p>Want to run Harvest on a Mac
  via <a href="../containerd/">containerd and Rancher Desktop</a>? We got you
  covered.</p>
</li>
<li>
<p><a href="../k8/">K8 Deployment</a> via Kompose</p>
</li>
</ul>
<h2 id="docker-compose">Docker Compose<a class="headerlink" href="#docker-compose" title="Permanent link">&para;</a></h2>
<p>This is a quick way to install and get started with Harvest. Follow the four steps below to:</p>
<ul>
<li>Setup Harvest, Grafana, and Prometheus via Docker Compose</li>
<li>Harvest dashboards are automatically imported and setup in Grafana with a Prometheus data source</li>
<li>A separate poller container is created for each monitored cluster</li>
<li>All pollers are automatically added as Prometheus scrape targets</li>
</ul>
<h3 id="setup-harvestyml">Setup harvest.yml<a class="headerlink" href="#setup-harvestyml" title="Permanent link">&para;</a></h3>
<ul>
<li>Create a <code>harvest.yml</code> file with your cluster details, below is an example with annotated comments. Modify as needed
   for your scenario.</li>
</ul>
<p>This config is using the Prometheus
exporter <a href="../../prometheus-exporter/#port_range">port_range</a>
feature, so you don't have to manage the Prometheus exporter port mappings for each poller.</p>
<div class="highlight"><pre><span></span><code>Exporters:
  prometheus1:
    exporter: Prometheus
    addr: 0.0.0.0
    port_range: 2000-2030  # &lt;====== adjust to be greater than equal to the number of monitored clusters

Defaults:
  collectors:
    - Zapi
    - ZapiPerf
    - EMS
  use_insecure_tls: true   # &lt;====== adjust as needed to enable/disable TLS checks 
  exporters:
    - prometheus1

Pollers:
  infinity:                # &lt;====== add your cluster(s) here, they use the exporter defined three lines above
    datacenter: DC-01
    addr: 10.0.1.2
    auth_style: basic_auth
    username: user
    password: 123#abc
  # next cluster ....  
</code></pre></div>
<h3 id="generate-a-docker-compose-for-your-pollers">Generate a Docker compose for your Pollers<a class="headerlink" href="#generate-a-docker-compose-for-your-pollers" title="Permanent link">&para;</a></h3>
<ul>
<li>Generate a Docker compose file from your <code>harvest.yml</code></li>
</ul>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--env<span class="w"> </span><span class="nv">UID</span><span class="o">=</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span><span class="w"> </span>--env<span class="w"> </span><span class="nv">GID</span><span class="o">=</span><span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--entrypoint<span class="w"> </span><span class="s2">&quot;bin/harvest&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--volume<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">:/opt/temp&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--volume<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/harvest.yml:/opt/harvest/harvest.yml&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>ghcr.io/netapp/harvest<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>generate<span class="w"> </span>docker<span class="w"> </span>full<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>harvest-compose.yml
</code></pre></div>
<p>By default, the above command uses the harvest configuration file(<code>harvest.yml</code>) located in the current directory. If you want to use a harvest config from a different location.</p>
<details class="question">
<summary>What if my harvest configuration file is somewhere else or not named harvest.yml</summary>
<p>Use the following docker run command, updating the <code>HYML</code> variable with the absolute path to your <code>harvest.yml</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nv">HYML</span><span class="o">=</span><span class="s2">&quot;/opt/custom_harvest.yml&quot;</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
--env<span class="w"> </span><span class="nv">UID</span><span class="o">=</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span><span class="w"> </span>--env<span class="w"> </span><span class="nv">GID</span><span class="o">=</span><span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="w"> </span><span class="se">\</span>
--entrypoint<span class="w"> </span><span class="s2">&quot;bin/harvest&quot;</span><span class="w"> </span><span class="se">\</span>
--volume<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">:/opt/temp&quot;</span><span class="w"> </span><span class="se">\</span>
--volume<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HYML</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">HYML</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
ghcr.io/netapp/harvest:latest<span class="w"> </span><span class="se">\</span>
generate<span class="w"> </span>docker<span class="w"> </span>full<span class="w"> </span><span class="se">\</span>
--output<span class="w"> </span>harvest-compose.yml<span class="w"> </span><span class="se">\</span>
--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HYML</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><code>generate docker full</code> does two things:</p>
<ol>
<li>Creates a Docker compose file with a container for each Harvest poller defined in your <code>harvest.yml</code></li>
<li>Creates a matching Prometheus service discovery file for each Harvest poller (located
   in <code>container/prometheus/harvest_targets.yml</code>). Prometheus uses this file to scrape the Harvest pollers.</li>
</ol>
<h3 id="start-everything">Start everything<a class="headerlink" href="#start-everything" title="Permanent link">&para;</a></h3>
<p>Bring everything up <img alt="" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f680.svg" title=":rocket:" /></p>
<div class="highlight"><pre><span></span><code>docker compose -f prom-stack.yml -f harvest-compose.yml up -d --remove-orphans
</code></pre></div>
<h3 id="note-on-docker-logging-configuration">Note on Docker Logging Configuration<a class="headerlink" href="#note-on-docker-logging-configuration" title="Permanent link">&para;</a></h3>
<p>By default, Docker uses the <code>json-file</code> logging driver which does not limit the size of the logs. This can cause your system to run out of disk space. Docker provides several options for logging configuration, including different logging drivers and options for log rotation.</p>
<p>Docker recommends using the <code>local</code> driver to prevent disk-exhaustion. More details can be found in <a href="https://docs.docker.com/config/containers/logging/configure/">Docker logging documentation</a></p>
<h2 id="prometheus-and-grafana">Prometheus and Grafana<a class="headerlink" href="#prometheus-and-grafana" title="Permanent link">&para;</a></h2>
<p>The <code>prom-stack.yml</code> compose file creates a <code>frontend</code> and <code>backend</code> network. Prometheus and Grafana publish their admin
ports on the front-end network and are routable to the local machine. By default, the Harvest pollers are part of the
backend network and also expose their Prometheus web end-points. 
If you do not want their end-points exposed, add the <code>--port=false</code> option to the <code>generate</code> sub-command in the <a href="#generate-a-docker-compose-for-your-pollers">previous step</a>.</p>
<h3 id="prometheus">Prometheus<a class="headerlink" href="#prometheus" title="Permanent link">&para;</a></h3>
<p>After bringing up the <code>prom-stack.yml</code> compose file, you can check Prometheus's list of targets
at <code>http://IP_OF_PROMETHEUS:9090/targets</code>.</p>
<h3 id="customize-prometheuss-retention-time">Customize Prometheus's Retention Time<a class="headerlink" href="#customize-prometheuss-retention-time" title="Permanent link">&para;</a></h3>
<p>By default, <code>prom-stack.yml</code> is configured for a one year data retention period.
To increase this, for example, to two years, you can create a specific configuration file and make your changes there.
This prevents your custom settings from being overwritten if you regenerate the default <code>prom-stack.yml</code> file.
Here's the process:</p>
<ul>
<li>Copy the original <code>prom-stack.yml</code> to a new file named <code>prom-stack-prod.yml</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>prom-stack.yml<span class="w"> </span>prom-stack-prod.yml
</code></pre></div>
<ul>
<li>Edit <code>prom-stack-prod.yml</code> to include the extended data retention setting by updating the <code>--storage.tsdb.retention.time=2y</code> line under the <strong>Prometheus</strong> service's <code>command</code> section:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">command</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--config.file=/etc/prometheus/prometheus.yml&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--storage.tsdb.path=/prometheus&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--storage.tsdb.retention.time=2y&#39;</span><span class="w">       </span><span class="c1"># Sets data retention to 2 years</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--web.console.libraries=/usr/share/prometheus/console_libraries&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--web.console.templates=/usr/share/prometheus/consoles&#39;</span>
</code></pre></div>
<ul>
<li>Save the changes to <code>prom-stack-prod.yml</code>.</li>
</ul>
<p>Now,
you can start your Docker containers with the updated configuration
that includes the 1-year data retention period by executing the command below:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>prom-stack-prod.yml<span class="w"> </span>-f<span class="w"> </span>harvest-compose.yml<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--remove-orphans
</code></pre></div>
<h3 id="grafana">Grafana<a class="headerlink" href="#grafana" title="Permanent link">&para;</a></h3>
<p>After bringing up the <code>prom-stack.yml</code> compose file, you can access Grafana at <code>http://IP_OF_GRAFANA:3000</code>.</p>
<p>You will be prompted to create a new password the first time you log in. Grafana's default credentials are</p>
<div class="highlight"><pre><span></span><code>username: admin
password: admin
</code></pre></div>
<h2 id="manage-pollers">Manage pollers<a class="headerlink" href="#manage-pollers" title="Permanent link">&para;</a></h2>
<h3 id="how-do-i-add-a-new-poller">How do I add a new poller?<a class="headerlink" href="#how-do-i-add-a-new-poller" title="Permanent link">&para;</a></h3>
<p>Note: All of your template customizations should follow the custom.yaml approach
mentioned in <a href="../../configure-templates/#templates-customization">template customization</a>,
otherwise any changes you've made in the <code>conf</code> directory will be overwritten.</p>
<ol>
<li>Add poller to <code>harvest.yml</code></li>
<li>Regenerate compose file by running <a href="#generate-a-docker-compose-for-your-pollers">harvest generate</a></li>
<li>Run <a href="#start-everything">docker compose up</a>, for example,</li>
</ol>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>prom-stack.yml<span class="w"> </span>-f<span class="w"> </span>harvest-compose.yml<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--remove-orphans
</code></pre></div>
<h3 id="stop-all-containers">Stop all containers<a class="headerlink" href="#stop-all-containers" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>docker compose -f prom-stack.yml -f harvest-compose.yml down
</code></pre></div>
<p>If you encounter the following error message while attempting to stop your Docker containers using <code>docker-compose down</code></p>
<div class="highlight"><pre><span></span><code>Error response from daemon: Conflict. The container name &quot;/poller-u2&quot; is already in use by container
</code></pre></div>
<p>This error is likely due to running <code>docker-compose down</code> from a different directory than where you initially ran <code>docker-compose up</code>.</p>
<p>To resolve this issue, make sure to run the <code>docker-compose down</code> command from the same directory where you ran <code>docker-compose up</code>. This will ensure that Docker can correctly match the container names and IDs with the directory you are working in. 
Alternatively, you can stop the Harvest, Prometheus, and Grafana containers by using the following command:</p>
<div class="highlight"><pre><span></span><code>docker ps -aq --filter &quot;name=prometheus&quot; --filter &quot;name=grafana&quot; --filter &quot;name=poller-&quot; | xargs docker stop | xargs docker rm
</code></pre></div>
<p>Note: Deleting or stopping Docker containers does not remove the data stored in Docker volumes.</p>
<h3 id="upgrade-harvest">Upgrade Harvest<a class="headerlink" href="#upgrade-harvest" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Note: If you want to keep your historical Prometheus data, and you set up your Docker Compose workflow before
Harvest <code>22.11</code>, please read how
to <a href="https://github.com/NetApp/harvest/blob/main/docs/MigratePrometheusDocker.md">migrate your Prometheus volume</a>
before continuing with the upgrade steps below.</p>
<p>If you need to customize your Prometheus configuration, such as changing the data retention period, please refer to the instructions on <a href="#customize-prometheuss-retention-time">customizing the Prometheus configuration</a>.</p>
</blockquote>
<p>To upgrade Harvest:</p>
<ol>
<li>
<p>Retrieve the most recent version of the Harvest Docker image by executing the following command.This is needed since the new version may contain new templates, dashboards, or other files not included in the Docker
   image.
   <div class="highlight"><pre><span></span><code>docker pull ghcr.io/netapp/harvest
</code></pre></div></p>
</li>
<li>
<p><a href="#stop-all-containers">Stop all containers</a></p>
</li>
<li>
<p>Regenerate your <code>harvest-compose.yml</code> file by
   running <a href="#generate-a-docker-compose-for-your-pollers">harvest generate</a>.
Make sure you don't skip this step. It is essential as it updates local copies of templates and dashboards, which are then mounted to the containers. If this step is skipped, Harvest will run with older templates and dashboards which will likely cause problems.
   By default, generate will use the <code>latest</code> tag. If you want to upgrade to a <code>nightly</code> build see the twisty.</p>
<details class="question">
<summary>I want to upgrade to a nightly build</summary>
<p>Tell the <code>generate</code> cmd to use a different tag like so:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--env<span class="w"> </span><span class="nv">UID</span><span class="o">=</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span><span class="w"> </span>--env<span class="w"> </span><span class="nv">GID</span><span class="o">=</span><span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--entrypoint<span class="w"> </span><span class="s2">&quot;bin/harvest&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--volume<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">:/opt/temp&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--volume<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/harvest.yml:/opt/harvest/harvest.yml&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>ghcr.io/netapp/harvest:nightly<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>generate<span class="w"> </span>docker<span class="w"> </span>full<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--image<span class="w"> </span>ghcr.io/netapp/harvest:nightly<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output<span class="w"> </span>harvest-compose.yml
</code></pre></div>
</details>
</li>
<li>
<p>Restart your containers using the following:</p>
<div class="highlight"><pre><span></span><code>docker compose -f prom-stack.yml -f harvest-compose.yml up -d --remove-orphans
</code></pre></div>
<details class="question">
<summary>Troubleshooting</summary>
<p>If you encounter the following error:</p>
<div class="highlight"><pre><span></span><code>network harvest_backend was found but has incorrect label com.docker.compose.network set to &quot;harvest_backend&quot;
</code></pre></div>
<p>Remove the conflicting networks:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>network<span class="w"> </span>rm<span class="w"> </span>harvest_backend<span class="w"> </span>harvest_frontend
</code></pre></div>
<p>Then, restart your containers again using the command above.</p>
</details>
</li>
</ol>
<h2 id="building-harvest-docker-image">Building Harvest Docker Image<a class="headerlink" href="#building-harvest-docker-image" title="Permanent link">&para;</a></h2>
<p>Building a custom Harvest Docker image is only necessary if you require a tailored solution. If your intention is to run Harvest using Docker without any customizations, please refer to the <a href="#docker-compose">Overview</a> section above.</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>.harvest.env
docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>container/onePollerPerContainer/Dockerfile<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">GO_VERSION</span><span class="o">=</span><span class="si">${</span><span class="nv">GO_VERSION</span><span class="si">}</span><span class="w"> </span>-t<span class="w"> </span>harvest:latest<span class="w"> </span>.<span class="w"> </span>--no-cache
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; NetApp
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/NetApp/harvest/blob/main/SUPPORT.md#getting-help" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/NetApp/harvest/discussions" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.e1c3ead8.min.js"></script>
      
        <script src="../../javascripts/open-dashboards.js"></script>
      
    
  </body>
</html>